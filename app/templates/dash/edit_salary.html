{% extends 'dash/base.html' %}

<title>{% block title %} MahavirTent- Salary {% endblock %}</title>
<!-- Bootstrap CSS -->



<!-- Main Content -->
{% block content %}
<!-- Main Content -->
<main class="main-content">
    <div class="header" style="color:white ;">
        <h2 class="px-4">Update Salary Details</h2>
    </div>
    <div class="container-fluid mt-4">
        <div class="card form-card">
            <div class="card-body">
                <!-- <h4 class="mb-4">Update Salary Details</h4> -->

                <form method="POST">
                    {% csrf_token %}

                    <div class="mb-3">
                        <label for="staff" class="form-label">Staff Name</label>
                        <input type="text" class="form-control" id="staff" value="{{ salary.staff.name }}" readonly>
                        <!-- hidden input to preserve staff ID in form submission -->
                        <input type="hidden" name="staff" value="{{ salary.staff.id }}">
                    </div>

                    <div class="mb-3">
                        <label for="salaryDate" class="form-label">Date</label>
                        <input type="date" class="form-control" id="salaryDate" name="month_date"
                            value="{{ salary.month_date|date:'Y-m-d' }}" required>
                    </div>

                    <div class="mb-3">
                        <label for="basicSalary" class="form-label">Basic Salary</label>
                        <input type="number" class="form-control" id="basicSalary" name="basic_salary" min="0"
                            value="{{ salary.basic_salary }}" required>
                    </div>

                    <div class="mb-3">
                        <label for="allowance" class="form-label">Allowance</label>
                        <input type="number" class="form-control" id="allowance" name="allowance" min="0"
                            value="{{ salary.allowance }}">
                    </div>

                    <div class="mb-3">
                        <label for="deduction" class="form-label">Deduction</label>
                        <input type="number" class="form-control" id="deduction" name="deduction" min="0"
                            value="{{ salary.deduction }}">
                    </div>

                    <div class="mb-3">
                        <label for="netSalary" class="form-label">Net Salary</label>
                        <input type="number" class="form-control" id="netSalary" name="net_salary"
                            value="{{ salary.net_salary }}" readonly>
                    </div>

                    <div class="mb-3">
                        <label for="salaryStatus" class="form-label">Status</label>
                        <select class="form-select" id="salaryStatus" name="status" required>
                            <option value="Paid" {% if salary.status == "Paid" %}selected{% endif %}>Paid</option>
                            <option value="Unpaid" {% if salary.status == "Unpaid" %}selected{% endif %}>Unpaid</option>
                        </select>
                    </div>

                    <div class="d-flex justify-content-end">
                        <button type="submit" class="btn btn-primary rounded-pill me-2 mt-3">Update</button>
                        <button type="Back" class="btn btn-secondary rounded-pill me-2 mt-3">Cancel</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</main>

</div>
</div>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
    xintegrity="sha384-YvpcrYf0tY3lHB60NNWqQWpsdYh/yJ83G1K9aA46Gq6Q0XpQY5R0J3q4z1A8W4A5l1yWpQ8B8T0Jb5K6f8E6"
    crossorigin="anonymous"></script>

<!-- Custom JS for Staff Search -->
<script>
    document.addEventListener("DOMContentLoaded", function () {
        const searchInput = document.getElementById("staffNameSearch");
        const suggestionsList = document.getElementById("staff-suggestions");
        const hiddenStaffId = document.getElementById("selectedStaffId");

        searchInput.addEventListener("keyup", function () {
            const query = this.value;
            if (query.length < 1) {
                suggestionsList.style.display = "none";
                return;
            }

            fetch(`/staff_search/?q=${query}`)
                .then(response => response.json())
                .then(data => {
                    suggestionsList.innerHTML = "";
                    if (data.length > 0) {
                        data.forEach(staff => {
                            const li = document.createElement("li");
                            li.textContent = staff.name;
                            li.style.padding = "5px";
                            li.style.cursor = "pointer";
                            li.onclick = function () {
                                searchInput.value = staff.name;
                                hiddenStaffId.value = staff.id;
                                suggestionsList.style.display = "none";
                            };
                            suggestionsList.appendChild(li);
                        });
                        suggestionsList.style.display = "block";
                    } else {
                        suggestionsList.style.display = "none";
                    }
                });
        });
    });
    // Auto-calc Net Salary
    document.querySelectorAll("#basicSalary, #allowance, #deduction").forEach(input => {
        input.addEventListener("input", () => {
            let basic = parseFloat(document.getElementById("basicSalary").value) || 0;
            let allowance = parseFloat(document.getElementById("allowance").value) || 0;
            let deduction = parseFloat(document.getElementById("deduction").value) || 0;
            document.getElementById("netSalary").value = (basic + allowance - deduction).toFixed(2);
        });
    });
</script>
{% endblock %}
</body>

</html>