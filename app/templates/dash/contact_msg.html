{% extends 'dash/base.html' %}
{% block content %}
<div class="container mt-4 ml-80 mr-10">
 <h3 class="fw-bold mb-4 mt-4 text-white">ðŸ“§ Contact Messages</h3>
  <table class="table table-bordered table-striped mt-3 align-middle text-center">
    <thead class="table-bordered">
      <tr>
        <th>#</th>
        <th>Name</th>
        <th>Email</th>
        <th>Mobile</th>
        <th>Address</th>
        <th>Subject</th>
        <th>Message</th>
        <th>Date</th>
        <th>Action</th>
      </tr>
    </thead>
    <tbody>
      {% for msg in messages_list %}
      <tr>
        <td>{{ forloop.counter }}</td>
        <td>{{ msg.name }}</td>
        <td>{{ msg.email }}</td>
        <td>{{ msg.mobile }}</td>
        <td>{{ msg.address }}</td>
        <td>{{ msg.subject }}</td>
        <td>{{ msg.message }}</td>
        <td>{{ msg.created_at|date:"d M Y, H:i" }}</td>
        <td>
          <!-- WhatsApp button -->
          <a href="https://wa.me/91{{ msg.mobile|cut:' ' }}" 
             target="_blank" 
             class="btn btn-success btn-sm">
            <i class="bi bi-whatsapp"></i> Chat
          </a>

          <!-- Delete button -->
          <form method="POST" 
                action="{% url 'delete_contact_message' msg.id %}" 
                style="display:inline;">
            {% csrf_token %}
            <button type="submit" 
                    class="btn btn-danger btn-sm"
                    onclick="return confirm('Are you sure you want to delete this message?');">
              <i class="bi bi-trash"></i> Delete
            </button>
          </form>
        </td>
      </tr>
      {% empty %}
      <tr>
        <td colspan="9" class="text-center">No messages yet.</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>

    <!-- Pagination -->
  {% if page_obj.has_other_pages %}
  <nav aria-label="Page navigation example">
    <ul class="pagination justify-content-center">
      {% if page_obj.has_previous %}
      <li class="page-item">
        <a class="page-link" href="?page={{ page_obj.previous_page_number }}">Previous</a>
      </li>
      {% else %}
      <li class="page-item disabled"><span class="page-link">Previous</span></li>
      {% endif %}

      {% for num in page_obj.paginator.page_range %}
      {% if page_obj.number == num %}
      <li class="page-item active"><span class="page-link">{{ num }}</span></li>
      {% else %}
      <li class="page-item"><a class="page-link" href="?page={{ num }}">{{ num }}</a></li>
      {% endif %}
      {% endfor %}

      {% if page_obj.has_next %}
      <li class="page-item">
        <a class="page-link" href="?page={{ page_obj.next_page_number }}">Next</a>
      </li>
      {% else %}
      <li class="page-item disabled"><span class="page-link">Next</span></li>
      {% endif %}
    </ul>
  </nav>
  {% endif %}
  
</div>
{% endblock %}
