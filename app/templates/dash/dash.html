    {% extends 'dash/base.html' %}

    {% block title %} MahavirTent - Dashboard {% endblock %}


    {% block content %}
    <main class="main-content">
        <!-- Top Navbar -->
        <nav class="navbar navbar-expand-lg mb-4">
            <div class="container-fluid">
                <a class="navbar-brand text-muted" href="#">Pages / Dashboard</a>
            </div>
        </nav>

        <!-- Stat Cards -->
        <div class="row g-4 mb-4">
            <div class="col-xl-3 col-sm-6">
                <div class="card p-3">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <p class="text-uppercase text-sm mb-0">Total Income</p>
                            <h5 class="mb-0 text-dark">{{ total_income }}</h5>
                        </div>
                        <div class="icon-box bg-gradient-green"><i class="fas fa-dollar-sign"></i></div>
                    </div>
                </div>
            </div>
            <div class="col-xl-3 col-sm-6">
                <div class="card p-3">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <p class="text-uppercase text-sm mb-0">Upcoming Events</p>
                            <h5 class="mb-0 text-dark">{{ total_events }}</h5>
                        </div>
                        <div class="icon-box bg-gradient-info"><i class="fas fa-calendar-alt"></i></div>
                    </div>
                </div>
            </div>
            <div class="col-xl-3 col-sm-6">
                <div class="card p-3">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <p class="text-uppercase text-sm mb-0">Expense</p>
                            <h5 class="mb-0 text-dark">{{ total_expense }}</h5>
                        </div>
                        <div class="icon-box bg-gradient-info"><i class="fas fa-calendar-alt"></i></div>
                    </div>
                </div>
            </div>
            <div class="col-xl-3 col-sm-6">
                <div class="card p-3">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <p class="text-uppercase text-sm mb-0">New Clients</p>
                            <h5 class="mb-0 text-dark">{{ new_clients }}</h5>
                        </div>
                        <div class="icon-box bg-gradient-orange"><i class="fas fa-user-plus"></i></div>
                    </div>
                </div>
            </div>
        </div>


          <!-- First Row: Upcoming Events Table and Event Calendar -->
    <div class="row g-4 mb-4">
        
          <div class="col-lg-7">
                <div class="card p-3">
                    <h5 class="section-header">Income vs Expense (Bar Chart)</h5>
                    <canvas id="barChart"></canvas>
                </div>
            </div>

              <div class="col-lg-5">
            <div class="card p-3">
                <h5 class="section-header">Event Calendar</h5>
                <div id="eventCalendar"></div>
            </div>
        </div>
        <div class="col-lg-7">
            <div class="card p-3">
                <h5 class="section-header">Upcoming Event Bookings</h5>
                <div class="table-responsive">
                     <table class="table align-items-center mb-0">
                            <thead>
                                <tr>
                                    <th>Customer</th>
                                    <th>Event Date</th>
                                    <th>Bill Number</th>
                                    <th>Pending Amount</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for bill in upcoming_events %}
                                <tr>
                                    <td>{{ bill.customer_name }}</td>
                                    <td>{{ bill.event_date|date:"d M, Y" }}</td>
                                    <td>{{ bill.bill_number }}</td>
                                    <td>${{ bill.pending }}</td>
                                </tr>
                                {% empty %}
                                <tr><td colspan="4" class="text-center">No upcoming events</td></tr>
                                {% endfor %}
                            </tbody>
                        </table>
                </div>
            </div>
        </div>
    
    </div>
        <!-- Charts Row -->
        <div class="row g-4 mb-4">

            <div class="col-lg-4">
                <div class="card p-2">
                    <h5 class="section-header">Payment Modes (Pie Chart)</h5>
                    <canvas id="pieChart"></canvas>
                </div>
            </div>

        </div>

        <!-- Line Chart & Upcoming Events -->
        <div class="row g-4 mb-4">
            <div class="col-lg-7">
                <div class="card p-3 mb-4">
                    <h5 class="section-header">Monthly Income (Last 6 Months)</h5>
                    <canvas id="lineChart"></canvas>
                </div>

            </div>

          
        </div>
    </main>

    <!-- JS Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.js"></script>

    <script>
        // Bar Chart
        new Chart(document.getElementById('barChart'), {
            type: 'bar',
            data: {
                labels: ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'],
                datasets: [
                    { label: 'Income', data: {{ income_data|safe }}, backgroundColor: '#198754' },
                    { label: 'Expense', data: {{ expense_data|safe }}, backgroundColor: '#dc3545' }
                ]
            }
        });

        // Pie Chart
        new Chart(document.getElementById('pieChart'), {
            type: 'pie',
            data: {
                labels: [{% for pm in payment_modes %}'{{ pm.payment_method }}'{% if not forloop.last %}, {% endif %}{% endfor %}],
                datasets: [{
                    data: [{% for pm in payment_modes %}{{ pm.total }}{% if not forloop.last %}, {% endif %}{% endfor %}],
                    backgroundColor: ['#0d6efd','#198754','#ffc107','#dc3545']
                }]
            }
        });

        // Line Chart
        new Chart(document.getElementById('lineChart'), {
            type: 'line',
            data: {
                labels: {{ last_6_months|safe }},
                datasets: [{
                    label: 'Monthly Income',
                    data: {{ income_last_6|safe }},
                    borderColor: '#0d6efd',
                    fill: false,
                    tension: 0.3
                }]
            }
        });

        // Event Calendar
        document.addEventListener('DOMContentLoaded', function () {
            var calendarEl = document.getElementById('eventCalendar');
            var calendar = new FullCalendar.Calendar(calendarEl, {
                initialView: 'dayGridMonth',
                events: [
                    {% for bill in upcoming_events %}
                    {
                        title: '{{ bill.customer_name }} - {{ bill.bill_number }}',
                        start: '{{ bill.event_date }}',
                        color: '#198754'
                    },
                    {% endfor %}
                ],
            });
            calendar.render();
        });
    </script>
    {% endblock %}
